window.Mashup=window.Mashup||{},_.templateSettings.interpolate=/\{\{(.+?)\}\}/g,Mashup.properties={bpmDelta:2,draggableDefaultOptions:{revert:"invalid",cursorAt:{left:85},helper:function(a){var b=$(this).clone();b.children("button").remove(),b.removeClass("highlight");var c=$("<li />").append(b).addClass("sampleSelected");return c}},droppableDefaultOptions:{accept:".sampleList li, .sample, #waveformSample",hoverClass:"hover",drop:function(a,b){var c=$(this),d=$(b.draggable.context).attr("data-sample-options"),e=JSON.parse(d);e.track=Mashup.GetTrack(c),e.rhythmIndex=Mashup.GetStartBeat(c);if($(b.draggable.context).attr("data-waveform")){e.playDuration=$("#sampleWaveform").audioViewer("getEndTime")-$("#sampleWaveform").audioViewer("getStartTime"),e.trimStart=0,e.id=(new Date).getTime(),e.waveFormElement="#sampleWaveform",Mashup.MoveSampleToPlayer(e,c);return}typeof e.playDuration=="undefined"&&(e.playDuration=e.duration),Mashup.MoveSampleToPlayer(e,c)}},maxSampleLength:15876e3,mouseCaptureOffset:0,mouseCapture:null,currentSlider:null,messageType:{Warning:"",Success:"alert-success",Error:"alert-error"},numberRegEx:/(\d{1,5})/},Mashup.Player={},Mashup.ShowMessage=function(a,b,c,d){Mashup.EndLoading(),c=typeof c=="undefined"?Mashup.properties.messageType.Warning:c;var e={Title:a,Message:b,AlertType:c},f=$("#mashup-message-template").html();typeof d=="undefined"&&(d="#main-content"),$(d).prepend(_.template(f,e))},Mashup.GenericErrorMessage=function(a,b,c){Mashup.EndLoading(),$(".modal").modal("hide");switch(a.status){case 400:var d=JSON.parse(a.responseText);return Mashup.ShowMessage("Not so fast",d.ResponseStatus.Message,Mashup.properties.messageType.Error),!1;case 401:return Mashup.ShowMessage("Unauthorized","You must be logged in to complete this action. Log in <a href='/Account/LogOn/' title='Log In' >here</a>",Mashup.properties.messageType.Warning),!1;default:var e=JSON.parse(a.responseText);if(e.ResponseStatus.ErrorCode=="BusinessServicesException")return Mashup.ShowMessage("Dang!",e.ResponseStatus.Message,Mashup.properties.messageType.Error),!1;return Mashup.ShowMessage("What the!","Sorry, we could not process your request.  The error has been logged and we will do our best to correct the error asap.",Mashup.properties.messageType.Error),!1}},Mashup.MoveSampleToPlayer=function(a,b){b.droppable("destroy");try{var c=b.audioSampleGraphical(a);Mashup.Player.audioPlayerGraphical("addSample",c)}catch(d){c&&c.audioSampleGraphical("destroy"),Mashup.ShowMessage("Schnikes!",d)}},Mashup.GetTrack=function(a){var b=a.parent();return $(".player").find(".track").index(b)},Mashup.GetStartBeat=function(a){var b=a.parent(),c=b.find('[class*="span"]').index(a),d=0,e=0,f=b.find(":first-child");while(e!=c)d+=f.outerWidth(),f=f.next(),e++;var g=Mashup.Player.audioPlayerGraphical("option","numberOfLoopBeats"),h=Mashup.Player.audioPlayerGraphical("option","beatIncrement"),i=b.width();return Math.round(d/i*g*h)},Mashup.GetSamples=function(){var a="/api/samples?format=json",b=$("#selectedSampleTags"),c=$("#PlayerBpm").val();Mashup.StartLoading("Loading samples...");var d=b.children(".artistId"),e=b.children(".tagId"),f=[],g=[];for(var h=0;h<d.length;h++)f.push(d.eq(h).attr("data-id"));for(var i=0;i<e.length;i++)g.push(e.eq(i).attr("data-id"));var j={Bpm:c,ArtistIds:f,TagIds:g,PageIndex:$("#pageIndex").val(),PageSize:$("#pageSize").val()};$.ajax({url:a,data:j,type:"POST",traditional:!0,success:function(a,b,c){var d=_.template($("#mashup-songlist-template").html()),e=$("#samples");return e.empty(),_.each(a.SampleList,function(a){e.append(d(a))}),$("#samplesAdded").val(a.SamplesAdded),e.children("li").draggable(Mashup.properties.draggableDefaultOptions),Mashup.AdjustPagers(),Mashup.EndLoading(),!1},error:Mashup.GenericErrorMessage})},Mashup.AdjustPagers=function(){var a=parseInt($("#pageIndex").val()),b=parseInt($("#pageSize").val()),c=parseInt($("#samplesAdded").val()),d=$("#samples li").length;if(a===0&&c>0){$(".next").hide();if(d===b){$(".previous").show();return}$(".previous").hide();return}a<=0&&d<b?$(".previous").hide():$(".previous").show(),a>=0&&d<b?$(".next").hide():$(".next").show()},Mashup.StartLoading=function(a){var b="Loading...Please Wait";typeof a!="undefined"&&(b=a),$("#loading span").text(b),$("#loading").show(),$("body").css("cursor","wait")},Mashup.EndLoading=function(){$("#loading").hide(),$("body").css("cursor","default")},Mashup.GetParameterByName=function(a){var b=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search);return b&&decodeURIComponent(b[1].replace(/\+/g," "))},Mashup.webAudioApi=function(){return!window.webkitAudioContext&&!window.AudioContext},Mashup.isFloat=function(a){return a===+a&&a!==(a|0)},Mashup.GetFormInput=function(a){var b={};return $.each($("#"+a).serializeArray(),function(a,c){c.name.indexOf(".")>=0&&(c.name=c.name.substring(c.name.indexOf(".")+1,c.name.length)),b[c.name]=c.value}),b}