(function(a,b,c,d){a.widget("Mashup.audioSample",{options:{loop:!1,fileName:null,sampleName:null,artist:null,bpm:88,id:0,rhythmIndex:0,track:0,mono:!1,duration:0,volume:.4096,pan:.5,effectType:-1,effect:.5,trimStart:0,shiftSample:0,playDuration:0},isGraphical:!1,_trimEnd:0,sampleUniqueId:0,_create:function(){this._calculateStartBeat(),this._calculateNumberOfBeats(),this._loadSample(),this.convolver=this.isGraphical?Mashup.Player.audioPlayerGraphical("getContext").createConvolver():Mashup.Player.audioPlayer("getContext").createConvolver()},_calculateStartBeat:function(){var a=this.isGraphical?Mashup.Player.audioPlayerGraphical("option","beatIncrement"):Mashup.Player.audioPlayer("option","beatIncrement");this.startBeat=Math.round(this.options.rhythmIndex/a)},_calculateNumberOfBeats:function(){this.numberOfBeats=Math.round(this.options.bpm/60*this.options.playDuration),this.numberOfBeats===0&&(this.numberOfBeats=1)},_calculateTempo:function(){this.options.bpm=this.numberOfBeats/this.options.duration*60},_loadSample:function(){var a=this.isGraphical?Mashup.Player.audioPlayerGraphical("getLoadedSampleById",this.options.id):Mashup.Player.audioPlayer("getLoadedSampleById",this.options.id);if(typeof a.buffer!="undefined"){this.buffer=a.buffer;return}if(typeof a.id!="undefined")return;a={id:this.options.id},this.isGraphical?Mashup.Player.audioPlayerGraphical("addLoadedSample",a):Mashup.Player.audioPlayer("addLoadedSample",a);var b=this,c=Mashup.properties.sampleFilePath+this.options.fileName,d=new XMLHttpRequest;d.open("GET",c,!0),d.responseType="arraybuffer",d.onload=function(){b.buffer=b.isGraphical?Mashup.Player.audioPlayerGraphical("getContext").createBuffer(d.response,b.options.mono):Mashup.Player.audioPlayer("getContext").createBuffer(d.response,b.options.mono),b.buffer.gain=b.options.volume,a={id:b.options.id,buffer:b.buffer},b.isGraphical?Mashup.Player.audioPlayerGraphical("updateLoadedSample",a):Mashup.Player.audioPlayer("updateLoadedSample",a)},d.send()},_setOption:function(a,b){switch(a){case"volume":b=Math.pow(b,4),this.options.volume=b,this.buffer!==null&&(this.buffer.gain=b);break;default:this.options[a]=b}this._super("_setOption",a,b)},getBuffer:function(){return this.buffer},getConvolver:function(){return this.convolver},getNumberOfBeats:function(){return this.numberOfBeats},getStartBeat:function(){return this.startBeat},getOptions:function(){return this.options},getUniqueIdentifier:function(){return this.sampleUniqueId},setBuffer:function(a){this.buffer=a,this.buffer.gain=this.options.volume},setBufferNode:function(a){this.bufferNode=a},setUniqueIdentifier:function(a){this.sampleUniqueId=a},stop:function(a){this.bufferNode!=null&&this.bufferNode.noteOff(a)},_destroy:function(){}})})(jQuery,window,document)